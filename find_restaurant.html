<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find a Restaurant - Penang One Better</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity=
     "sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lilita+One&family=Luckiest+Guy&family=Oswald:wght@200..700&display=swap" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>
    <nav class="navbar navbar-expand-xl">
        <div class="container-fluid">
            <a class="navbar-brand" href="index.html"><img src="images/brand-logo.png" height="50" width="180"></a>
            <button class="navbar-toggler order-last" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav mx-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">HOME</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="food_gallery.html">FOOD GALLERY</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="find_restaurant.html">FIND A RESTAURANT</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="my_favourite.html">MY FAVOURITE</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="quiz.html">QUIZ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="about.html">ABOUT</a>
                    </li>
                </ul>
                <ul class="navbar-nav" id="nav-auth-section"></ul>
            </div>
        </div>
    </nav>

    <!-- Restaurant Finder Section -->
    <main>
        <section class="restaurant-section" style="background-color: #FEFAE0; padding: 50px 0;">
            <div class="container">
                <div class="text-center mb-5">
                    <h1 class="display-4 fw-bold text-dark">FIND A RESTAURANT</h1>
                    <p class="lead">Discover the best Penang street food restaurants and stalls</p>

                    <div class="mt-3">
                        <span class="badge bg-success fs-6 me-2">ü™ô Authentic Restaurants</span>
                        <span class="badge bg-info fs-6 me-2">‚≠ê Top Rated</span>
                        <span class="badge bg-warning text-dark fs-6">üìç All Areas Covered</span>
                    </div>
                </div>

                <!-- Cross Navigation Cards -->
                <div class="row mb-4">
                    <div class="col-md-4 mb-3">
                        <div class="card bg-light border-success">
                            <div class="card-body text-center">
                                <i class="bi bi-cup-hot text-success" style="font-size: 2rem;"></i>
                                <h6 class="card-title mt-2">Explore Foods</h6>
                                <p class="card-text small">Discover delicious Penang dishes</p>
                                <a href="food_gallery.html" class="btn btn-success btn-sm">
                                    <i class="bi bi-arrow-right me-1"></i>Food Gallery
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card bg-light border-danger">
                            <div class="card-body text-center">
                                <i class="bi bi-heart-fill text-danger" style="font-size: 2rem;"></i>
                                <h6 class="card-title mt-2">Your Favourites</h6>
                                <p class="card-text small">View your saved places</p>
                                <a href="my_favourite.html" class="btn btn-danger btn-sm">
                                    <i class="bi bi-heart me-1"></i>My Favourites
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card bg-light border-warning">
                            <div class="card-body text-center">
                                <i class="bi bi-star-fill text-warning" style="font-size: 2rem;"></i>
                                <h6 class="card-title mt-2">Favourite Restaurants</h6>
                                <p class="card-text small" id="favourite-count-display">0 saved restaurants</p>
                                <button class="btn btn-warning btn-sm text-dark" id="show-favourites-btn">
                                    <i class="bi bi-list me-1"></i>Show Favourites
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Search and Filter Controls -->
                <div class="row mb-4">
                    <div class="col-md-6 mb-3">
                        <div class="input-group">
                            <span class="input-group-text"><i class="bi bi-search"></i></span>
                            <input type="text" class="form-control" id="search-input" placeholder="Search restaurants, cuisine, or location...">
                            <button class="btn btn-success" type="button" id="search-btn">Search</button>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <select class="form-select" id="area-filter">
                            <option value="all">All Areas</option>
                            <option value="georgetown">Georgetown</option>
                            <option value="gurney">Gurney Drive</option>
                            <option value="penang-road">Penang Road</option>
                            <option value="air-itam">Air Itam</option>
                            <option value="little-india">Little India</option>
                            <option value="jalan-dato-keramat">Jalan Dato Keramat</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <select class="form-select" id="sort-select">
                            <option value="rating">Sort by Rating</option>
                            <option value="name">Sort by Name</option>
                            <option value="price">Sort by Price</option>
                        </select>
                    </div>
                </div>

                <!-- Quick Filters -->
                <div class="text-center mb-4">
                    <h5 class="mb-3">Quick Filters:</h5>
                    <div class="btn-group flex-wrap" role="group">
                        <button type="button" class="btn btn-outline-success filter-btn active" data-filter="all">All Restaurants</button>
                        <button type="button" class="btn btn-outline-success filter-btn" data-filter="favourites">My Favourites</button>
                        <button type="button" class="btn btn-outline-success filter-btn" data-filter="street-food">Street Food</button>
                        <button type="button" class="btn btn-outline-success filter-btn" data-filter="hawker-center">Hawker Centers</button>
                        <button type="button" class="btn btn-outline-success filter-btn" data-filter="kopitiam">Kopitiams</button>
                        <button type="button" class="btn btn-outline-success filter-btn" data-filter="high-rated">4.5+ Rating</button>
                        <button type="button" class="btn btn-outline-success filter-btn" data-filter="budget">Budget Friendly</button>
                    </div>
                </div>

                <!-- Map Preview -->
                <div class="row mb-5">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0"><i class="bi bi-map me-2"></i>Restaurant Map View</h5>
                                <button class="btn btn-outline-primary btn-sm" id="toggle-map">
                                    <i class="bi bi-eye me-1"></i><span id="map-toggle-text">Show Map</span>
                                </button>
                            </div>
                            <div class="card-body p-0">
                                <div id="restaurant-map" class="bg-light text-center py-5" style="display: none; min-height: 350px;">
                                    <div class="d-flex align-items-center justify-content-center h-100">
                                        <div>
                                            <div class="spinner-border text-success mb-3" role="status">
                                                <span class="visually-hidden">Loading map...</span>
                                            </div>
                                            <h5>Loading Map View...</h5>
                                            <p class="text-muted">Please wait while we load restaurant locations</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Loading Spinner -->
                <div id="loading" class="text-center" style="display: none;">
                    <div class="spinner-border text-success" role="status" style="width: 3rem; height: 3rem;">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-3">Finding restaurants for you...</p>
                </div>

                <!-- Restaurant Results Stats -->
                <div id="results-stats" class="row mb-4" style="display: none;">
                    <div class="col-md-4 mb-3">
                        <div class="card text-center h-100">
                            <div class="card-body">
                                <i class="bi bi-shop text-success" style="font-size: 2rem;"></i>
                                <h4 class="card-title mt-2" id="total-restaurants">0</h4>
                                <p class="card-text">Restaurants Found</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card text-center h-100">
                            <div class="card-body">
                                <i class="bi bi-star-fill text-warning" style="font-size: 2rem;"></i>
                                <h4 class="card-title mt-2" id="avg-rating">0.0</h4>
                                <p class="card-text">Average Rating</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card text-center h-100">
                            <div class="card-body">
                                <i class="bi bi-geo-alt text-primary" style="font-size: 2rem;"></i>
                                <h4 class="card-title mt-2" id="areas-covered">0</h4>
                                <p class="card-text">Areas Covered</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Restaurants Grid -->
                <div id="restaurants-container" class="row">
                    <!-- Restaurants will be loaded here -->
                </div>

                <!-- No Results Message -->
                <div id="no-results" class="text-center py-5" style="display: none;">
                    <i class="bi bi-search text-muted" style="font-size: 4rem;"></i>
                    <h3 class="mt-3 text-muted">No Restaurants Found</h3>
                    <p class="text-muted">Try adjusting your search criteria or filters</p>
                    <button class="btn btn-success" onclick="clearFilters()">Clear All Filters</button>
                </div>

                <!-- Load More Button -->
                <div class="text-center mt-4">
                    <button id="load-more-btn" class="btn btn-outline-success btn-lg" style="display: none;">
                        <i class="bi bi-plus-circle me-2"></i>Load More Restaurants
                    </button>
                </div>
            </div>
        </section>
    </main>

    <!-- Restaurant Details Modal -->
    <div class="modal fade" id="restaurantModal" tabindex="-1" aria-labelledby="restaurantModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="restaurantModalLabel">Restaurant Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="modal-content">
                    <!-- Dynamic content will be loaded here -->
                </div>
                <div class="modal-footer">
                    <div class="share-buttons">
                        <button type="button" class="btn btn-success" id="share-whatsapp">
                            <i class="bi bi-whatsapp"></i> Share
                        </button>
                        <button type="button" class="btn btn-info text-white" id="get-directions">
                            <i class="bi bi-compass"></i> Get Directions
                        </button>
                        <button type="button" class="btn btn-warning text-dark" id="add-to-favorites">
                            <i class="bi bi-heart"></i> Add to Favorites
                        </button>
                    </div>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer text-center text-white py-4">
        <div class="container">
            <p class="footer-text">¬© 2025 Penang One Better. All rights reserved.</p>
            <div class="mt-2">
                <a href="#" target="_blank" rel="noopener noreferrer" class="text-white mx-2"><i class="bi bi-facebook"></i></a>
                <a href="#" target="_blank" rel="noopener noreferrer" class="text-white mx-2"><i class="bi bi-whatsapp"></i></a>
                <a href="#" target="_blank" rel="noopener noreferrer" class="text-white mx-2"><i class="bi bi-instagram"></i></a>
                <a href="https://github.com/TimLok0319/Street-Food-Introduction-Website" target="_blank" rel="noopener noreferrer" class="text-white mx-2"><i class="bi bi-github"></i></a>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Global variables
        let allRestaurants = [];
        let displayedRestaurants = [];
        let favouriteRestaurants = [];
        let currentFilter = 'all';
        let currentArea = 'all';
        let currentSort = 'rating';
        let currentPage = 1;
        const restaurantsPerPage = 12;

        $(document).ready(function () {
            initializePage();
            updateNavbar();
            loadFavouriteRestaurants();
            updateFavouriteCount();

            // Event handlers
            $('#search-btn').click(performSearch);
            $('#search-input').keypress(function (e) {
                if (e.which === 13) performSearch();
            });

            $('#area-filter').change(function () {
                currentArea = $(this).val();
                filterRestaurants();
            });

            $('#sort-select').change(function () {
                currentSort = $(this).val();
                sortRestaurants();
            });

            $('.filter-btn').click(function () {
                $('.filter-btn').removeClass('active');
                $(this).addClass('active');
                currentFilter = $(this).data('filter');
                filterRestaurants();
            });

            $('#toggle-map').click(toggleMap);
            $('#load-more-btn').click(loadMoreRestaurants);
            $('#show-favourites-btn').click(function () {
                currentFilter = 'favourites';
                $('.filter-btn').removeClass('active');
                $('.filter-btn[data-filter="favourites"]').addClass('active');
                filterRestaurants();
            });

            // Modal event handlers (using event delegation)
            $(document).on('click', '#share-whatsapp', shareRestaurant);
            $(document).on('click', '#get-directions', function () {
                console.log('Get directions button clicked in modal');
                console.log('Current modal restaurant:', window.currentModalRestaurant);
                getDirections();
            });
            $(document).on('click', '#add-to-favorites', addToFavorites);
        });

        async function initializePage() {
            showLoading(true);

            // Force clear any cached restaurant data
            allRestaurants = [];
            displayedRestaurants = [];

            await loadRestaurants();

            // Debug: Log all restaurant names
            console.log('=== RESTAURANT CHECK ===');
            allRestaurants.forEach(r => {
                console.log(`ID: ${r.id}, Name: ${r.name}`);
            });
            console.log('=== END CHECK ===');

            displayedRestaurants = [...allRestaurants];
            displayRestaurants();
            updateStats();
            showLoading(false);

            // Check if we need to highlight a specific restaurant
            const highlightId = localStorage.getItem('highlightRestaurant');
            if (highlightId) {
                setTimeout(() => {
                    const restaurantCard = $(`.restaurant-card[data-restaurant-id="${highlightId}"]`);
                    if (restaurantCard.length) {
                        restaurantCard.addClass('border-warning border-3');
                        restaurantCard[0].scrollIntoView({ behavior: 'smooth', block: 'center' });
                        setTimeout(() => {
                            restaurantCard.removeClass('border-warning border-3');
                        }, 3000);
                    }
                }, 500);
                localStorage.removeItem('highlightRestaurant');
            }
        }

        async function loadRestaurants() {
            // Simulate loading from API
            allRestaurants = getLocalRestaurants();

            // Optionally load from external API
            try {
                // Example of loading restaurant data from an API
                const response = await $.ajax({
                    url: 'https://jsonplaceholder.typicode.com/posts',
                    method: 'GET',
                    dataType: 'json',
                    timeout: 5000
                });

                // Transform API data if needed
                console.log('External API data loaded (for demo purposes)');
            } catch (error) {
                console.log('Using local restaurant data');
            }
        }

        function loadFavouriteRestaurants() {
            favouriteRestaurants = JSON.parse(localStorage.getItem('penangRestaurantFavorites') || '[]');
        }

        function updateFavouriteCount() {
            const count = favouriteRestaurants.length;
            $('#favourite-count-display').text(`${count} saved restaurant${count !== 1 ? 's' : ''}`);
        }

        function getLocalRestaurants() {
            return [
                {
                    id: "rest001",
                    name: "Penang Road Famous Laksa",
                    image: "images/penang-road-laksa.jpg",
                    description: "Famous for authentic Penang Assam Laksa with Michelin Bib Gourmand recognition. Third-generation family recipe established in 1970.",
                    cuisine: ["Malaysian", "Street Food", "Noodles"],
                    area: "georgetown",
                    address: "5-7, Lebuh Keng Kwee, George Town, 10100 Penang",
                    rating: 4.6,
                    price_range: "$",
                    phone: "+60 16-446 0543",
                    hours: "9:00 AM - 5:30 PM (Mon-Tue, Thu-Sun), Closed Wed",
                    specialties: ["Penang Asam Laksa", "Char Kway Teow", "Oyster Omelette"],
                    type: "street-food",
                    coordinates: { lat: 5.4164, lng: 100.3327 }
                },
                {
                    id: "rest002",
                    name: "Ah Leng Char Kway Teow",
                    image: "images/ah-leng-char-kway-teow.JPG",
                    description: "Famous Char Kway Teow served since 1979. Known for perfectly balanced wok hei flavor and generous prawns with duck egg option.",
                    cuisine: ["Chinese", "Street Food", "Noodles"],
                    area: "jalan-dato-keramat",
                    address: "343, Jalan Dato Keramat, George Town, 10150 Penang (Within Restoran Tong Hooi)",
                    rating: 4.5,
                    price_range: "$-$$",
                    phone: "+60 4-226 0819",
                    hours: "10:30 AM - 4:00 PM (Mon-Tue, Fri-Sun), Closed Wed-Thu",
                    specialties: ["Char Kway Teow", "Duck Egg CKT", "Special CKT with Mantis Prawns"],
                    type: "street-food",
                    coordinates: { lat: 5.4141, lng: 100.3288 }
                },
                {
                    id: "rest003",
                    name: "Super Hokkien Mee",
                    image: "images/super-hokkien-mee.JPG",
                    description: "Traditional Penang Hokkien Mee with rich prawn broth. Second-generation hawker with 60 years of legacy since the old Kim San coffeeshop.",
                    cuisine: ["Chinese", "Street Food", "Noodles"],
                    area: "georgetown",
                    address: "2, One Corner Caf√©, Jalan Bawasah, 10050 George Town, Penang",
                    rating: 4.4,
                    price_range: "$",
                    phone: "+60 4-227 3920",
                    hours: "8:00 AM - 3:00 PM",
                    specialties: ["Hokkien Mee", "Prawn Broth Noodles"],
                    type: "street-food",
                    coordinates: { lat: 5.4104, lng: 100.3298 }
                },
                {
                    id: "rest004",
                    name: "Line Clear Nasi Kandar",
                    image: "images/line-clear-nasi-kandar.jpg",
                    description: "Iconic 24-hour Nasi Kandar restaurant. One of the oldest nasi kandar establishments famous for their curry chicken and unique gravy mix.",
                    cuisine: ["Indian", "Muslim", "Rice"],
                    area: "penang-road",
                    address: "177, Jalan Penang, George Town, 10000 Penang",
                    rating: 4.7,
                    price_range: "$-$$",
                    phone: "+60 4-261 4440",
                    hours: "24 Hours",
                    specialties: ["Nasi Kandar", "Curry Chicken", "Mixed Curry", "Fish Head Curry"],
                    type: "street-food",
                    coordinates: { lat: 5.4154, lng: 100.3319 }
                },
                {
                    id: "rest005",
                    name: "Gurney Drive Hawker Centre",
                    image: "images/gurney-drive-hawker.jpg",
                    description: "Famous seaside hawker center with over 50 stalls operating since the 1970s. Perfect sunset dining experience by the sea.",
                    cuisine: ["Various", "Street Food", "Hawker"],
                    area: "gurney",
                    address: "172, Solok Gurney 1, 10250 George Town, Penang",
                    rating: 4.3,
                    price_range: "$-$$",
                    phone: "+60 16-497 3907",
                    hours: "5:00 PM - 11:00 PM",
                    specialties: ["Char Kway Teow", "Satay", "Oyster Omelette", "Rojak", "Cendol"],
                    type: "hawker-center",
                    coordinates: { lat: 5.4385, lng: 100.3089 }
                },
                {
                    id: "rest006",
                    name: "Hameediyah Restaurant",
                    image: "images/hameediyah-restaurant.jpg",
                    description: "Oldest nasi kandar restaurant in Malaysia, established 1907. Rich history with authentic family recipes passed down through generations.",
                    cuisine: ["Indian", "Muslim", "Rice"],
                    area: "little-india",
                    address: "164A, Lebuh Campbell, George Town, 10100 Penang",
                    rating: 4.5,
                    price_range: "$-$$",
                    phone: "+60 4-261 1095",
                    hours: "10:00 AM - 10:00 PM (Closed Friday)",
                    specialties: ["Nasi Kandar", "Mutton Curry", "Fish Curry", "Murtabak", "Beef Rendang"],
                    type: "street-food",
                    coordinates: { lat: 5.4133, lng: 100.3356 }
                },
                {
                    id: "rest007",
                    name: "Kek Seng Coffee Shop",
                    image: "images/kek-seng-coffee.jpg",
                    description: "Traditional kopitiam established since 1906. Famous for homemade durian ice cream and traditional coffee. Heritage ambiance with wooden furniture.",
                    cuisine: ["Desserts", "Coffee", "Local"],
                    area: "penang-road",
                    address: "382-384, Penang Road, 10350 Georgetown, Penang",
                    rating: 4.2,
                    price_range: "$",
                    phone: "+60 16-412 1300",
                    hours: "8:00 AM - 6:00 PM",
                    specialties: ["Durian Ice Cream", "Ice Kacang", "Traditional Coffee", "Hainan Chicken Rice"],
                    type: "kopitiam",
                    coordinates: { lat: 5.4149, lng: 100.3315 }
                },
                {
                    id: "rest008",
                    name: "Air Itam Sister Curry Mee",
                    image: "images/sister-curry-mee.jpg",
                    description: "Famous curry mee stall with Michelin Guide recognition. Run by the Lim sisters since 1946, serving Penang-style curry mee cooked over charcoal.",
                    cuisine: ["Malaysian", "Chinese", "Noodles"],
                    area: "air-itam",
                    address: "612-T, Jalan Air Itam, Pekan Ayer Itam, 11500 Ayer Itam, Pulau Pinang",
                    rating: 4.3,
                    price_range: "$",
                    phone: "+60 12-410 8152",
                    hours: "7:30 AM - 1:00 PM (Mon, Wed-Sun), Closed Tue",
                    specialties: ["Curry Mee", "Charcoal-cooked Curry Broth", "Cuttlefish", "Tofu Puffs"],
                    type: "street-food",
                    coordinates: { lat: 5.4194, lng: 100.2710 }
                }
            ];
        }

        function performSearch() {
            const searchTerm = $('#search-input').val().trim().toLowerCase();
            if (!searchTerm) {
                displayedRestaurants = [...allRestaurants];
                displayRestaurants();
                return;
            }

            const searchResults = allRestaurants.filter(restaurant =>
                restaurant.name.toLowerCase().includes(searchTerm) ||
                restaurant.description.toLowerCase().includes(searchTerm) ||
                restaurant.cuisine.some(c => c.toLowerCase().includes(searchTerm)) ||
                restaurant.area.toLowerCase().includes(searchTerm) ||
                restaurant.specialties.some(s => s.toLowerCase().includes(searchTerm))
            );

            displayedRestaurants = searchResults;
            displayRestaurants();
        }

        function filterRestaurants() {
            let filtered = [...allRestaurants];

            // Apply area filter
            if (currentArea !== 'all') {
                filtered = filtered.filter(restaurant => restaurant.area === currentArea);
            }

            // Apply type filter
            if (currentFilter !== 'all') {
                switch (currentFilter) {
                    case 'favourites':
                        const favouriteIds = favouriteRestaurants.map(fav => fav.id);
                        filtered = filtered.filter(restaurant => favouriteIds.includes(restaurant.id));
                        break;
                    case 'street-food':
                        filtered = filtered.filter(restaurant => restaurant.type === 'street-food');
                        break;
                    case 'hawker-center':
                        filtered = filtered.filter(restaurant => restaurant.type === 'hawker-center');
                        break;
                    case 'kopitiam':
                        filtered = filtered.filter(restaurant => restaurant.type === 'kopitiam');
                        break;
                    case 'high-rated':
                        filtered = filtered.filter(restaurant => restaurant.rating >= 4.5);
                        break;
                    case 'budget':
                        filtered = filtered.filter(restaurant => restaurant.price_range === '$');
                        break;
                }
            }

            displayedRestaurants = filtered;
            sortRestaurants();
        }

        function sortRestaurants() {
            switch (currentSort) {
                case 'rating':
                    displayedRestaurants.sort((a, b) => b.rating - a.rating);
                    break;
                case 'name':
                    displayedRestaurants.sort((a, b) => a.name.localeCompare(b.name));
                    break;
                case 'price':
                    displayedRestaurants.sort((a, b) => a.price_range.length - b.price_range.length);
                    break;
            }
            displayRestaurants();
        }

        function displayRestaurants() {
            const container = $('#restaurants-container');
            container.empty();

            if (displayedRestaurants.length === 0) {
                $('#no-results').show();
                $('#results-stats').hide();
                return;
            }

            $('#no-results').hide();
            $('#results-stats').show();
            updateStats();

            const restaurantsToShow = displayedRestaurants.slice(0, currentPage * restaurantsPerPage);

            restaurantsToShow.forEach(restaurant => {
                const ratingStars = generateRatingStars(restaurant.rating);
                const cuisineString = restaurant.cuisine.slice(0, 2).join(', ');
                const isFavourite = favouriteRestaurants.some(fav => fav.id === restaurant.id);
                const favouriteIcon = isFavourite ? 'bi-heart-fill text-danger' : 'bi-heart text-muted';

                const restaurantCard = `
                        <div class="col-md-6 col-lg-4 mb-4">
                            <div class="card h-100 shadow-sm restaurant-card" data-restaurant-id="${restaurant.id}">
                                <div class="position-relative">
                                    <img src="${restaurant.image}" class="card-img-top" alt="${restaurant.name}"
                                         style="height: 200px; object-fit: cover;"
                                         onerror="this.src='https://via.placeholder.com/300x200?text=Restaurant'">
                                    <div class="position-absolute top-0 start-0 m-2">
                                        <span class="badge bg-success">${restaurant.type.replace('-', ' ').toUpperCase()}</span>
                                    </div>
                                    <div class="position-absolute top-0 end-0 m-2">
                                        <span class="badge bg-dark">‚≠ê ${restaurant.rating}</span>
                                    </div>
                                    <div class="position-absolute bottom-0 end-0 m-2">
                                        <button class="btn btn-sm btn-light favourite-toggle-btn" data-restaurant-id="${restaurant.id}" title="${isFavourite ? 'Remove from favourites' : 'Add to favourites'}">
                                            <i class="bi ${favouriteIcon}"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body d-flex flex-column">
                                    <h5 class="card-title">${restaurant.name}</h5>
                                    <p class="card-text flex-grow-1">${restaurant.description.substring(0, 100)}...</p>
                                    <div class="mt-auto">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <div class="rating">
                                                ${ratingStars}
                                                <small class="text-muted ms-1">(${restaurant.rating})</small>
                                            </div>
                                            <small class="text-muted">${restaurant.price_range}</small>
                                        </div>
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <span class="badge bg-warning text-dark">${cuisineString}</span>
                                            <small class="text-success fw-bold">${restaurant.hours.split('-')[0].trim()}</small>
                                        </div>
                                        <div class="d-flex justify-content-between align-items-center">
                                            <small class="text-muted">üìç ${restaurant.area.replace('-', ' ')}</small>
                                            <small class="text-primary">üìû ${restaurant.phone.substring(0, 12)}...</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-footer">
                                    <div class="row g-2">
                                        <div class="col-8">
                                            <button class="btn btn-success btn-sm w-100 view-details-btn" data-restaurant-id="${restaurant.id}">
                                                <i class="bi bi-eye me-1"></i>View Details
                                            </button>
                                        </div>
                                        <div class="col-4">
                                            <button class="btn btn-outline-primary btn-sm w-100 directions-btn" data-restaurant-id="${restaurant.id}" title="Directions">
                                                <i class="bi bi-compass"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                container.append(restaurantCard);
            });

            // Show/hide load more button
            if (restaurantsToShow.length < displayedRestaurants.length) {
                $('#load-more-btn').show();
            } else {
                $('#load-more-btn').hide();
            }

            // Add click handlers
            $('.view-details-btn').click(function () {
                const restaurantId = $(this).data('restaurant-id');
                showRestaurantDetails(restaurantId);
            });

            $('.directions-btn').click(function () {
                const restaurantId = $(this).data('restaurant-id');
                console.log('Directions button clicked for restaurant ID:', restaurantId);
                getDirections(restaurantId);
            });

            $('.favourite-toggle-btn').click(function (e) {
                e.stopPropagation();
                const restaurantId = $(this).data('restaurant-id');
                toggleFavourite(restaurantId, $(this));
            });
        }

        function toggleFavourite(restaurantId, buttonElement) {
            const restaurant = allRestaurants.find(r => r.id === restaurantId);
            if (!restaurant) return;

            const isFavourite = favouriteRestaurants.some(fav => fav.id === restaurantId);

            if (isFavourite) {
                // Remove from favourites
                favouriteRestaurants = favouriteRestaurants.filter(fav => fav.id !== restaurantId);
                localStorage.setItem('penangRestaurantFavorites', JSON.stringify(favouriteRestaurants));

                // Update button
                buttonElement.find('i').removeClass('bi-heart-fill text-danger').addClass('bi-heart text-muted');
                buttonElement.attr('title', 'Add to favourites');

                showToast('Removed from Favourites', `${restaurant.name} has been removed from your favourites.`, 'info');
            } else {
                // Add to favourites
                favouriteRestaurants.push(restaurant);
                localStorage.setItem('penangRestaurantFavorites', JSON.stringify(favouriteRestaurants));

                // Update button
                buttonElement.find('i').removeClass('bi-heart text-muted').addClass('bi-heart-fill text-danger');
                buttonElement.attr('title', 'Remove from favourites');

                showToast('Added to Favourites!', `${restaurant.name} has been added to your favourites.`, 'success');
            }

            updateFavouriteCount();

            // If currently showing favourites filter, refresh the display
            if (currentFilter === 'favourites') {
                filterRestaurants();
            }
        }

        function showRestaurantDetails(restaurantId) {
            const restaurant = allRestaurants.find(r => r.id === restaurantId);
            console.log('Showing details for restaurant ID:', restaurantId);
            console.log('Found restaurant:', restaurant);

            if (!restaurant) {
                console.error('Restaurant not found with ID:', restaurantId);
                return;
            }

            // Store the current restaurant for modal actions
            window.currentModalRestaurant = restaurant;
            renderRestaurantModal(restaurant);
        }

        function renderRestaurantModal(restaurant) {
            const ratingStars = generateRatingStars(restaurant.rating);

            const modalContent = `
                    <div class="row">
                        <div class="col-md-6">
                            <img src="${restaurant.image}" class="img-fluid rounded shadow" alt="${restaurant.name}"
                                 onerror="this.src='https://via.placeholder.com/400x300?text=Restaurant'">
                            <div class="mt-3 text-center">
                                <div class="rating-large">
                                    ${ratingStars}
                                    <span class="fs-5 fw-bold ms-2">${restaurant.rating}/5</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h3>${restaurant.name}</h3>
                            <div class="mb-3">
                                <span class="badge bg-success me-2">${restaurant.type.replace('-', ' ').toUpperCase()}</span>
                                <span class="badge bg-warning text-dark me-2">${restaurant.cuisine.join(', ')}</span>
                                <span class="badge bg-primary">${restaurant.price_range}</span>
                            </div>
                            <p class="lead">${restaurant.description}</p>

                            <div class="row mb-3">
                                <div class="col-12 mb-3">
                                    <strong><i class="bi bi-geo-alt text-primary me-1"></i>Address:</strong><br>
                                    <small>${restaurant.address}</small>
                                </div>
                                <div class="col-12 mb-3">
                                    <strong><i class="bi bi-telephone text-success me-1"></i>Phone:</strong><br>
                                    <small>${restaurant.phone}</small>
                                </div>
                                <div class="col-12 mb-3">
                                    <strong><i class="bi bi-clock text-warning me-1"></i>Hours:</strong><br>
                                    <small>${restaurant.hours}</small>
                                </div>
                            </div>

                            <div class="mb-3">
                                <strong><i class="bi bi-star-fill text-warning me-1"></i>Specialties:</strong><br>
                                <div class="mt-2">
                                    ${restaurant.specialties.map(specialty => `
                                        <span class="badge bg-light text-dark me-1 mb-1">${specialty}</span>
                                    `).join('')}
                                </div>
                            </div>

                            <hr>
                            <h6><i class="bi bi-info-circle me-2"></i>Quick Info:</h6>
                            <div class="row">
                                <div class="col-6">
                                    <small><strong>Cuisine:</strong> ${restaurant.cuisine.join(', ')}</small>
                                </div>
                                <div class="col-6">
                                    <small><strong>Area:</strong> ${restaurant.area.replace('-', ' ')}</small>
                                </div>
                            </div>

                            <div class="mt-3">
                                <button class="btn btn-primary btn-sm me-2" onclick="window.open('food_gallery.html', '_blank')">
                                    <i class="bi bi-cup-hot me-1"></i>View Foods
                                </button>
                                <button class="btn btn-outline-success btn-sm" onclick="window.open('my_favourite.html', '_blank')">
                                    <i class="bi bi-heart me-1"></i>My Favourites
                                </button>
                            </div>
                        </div>
                    </div>
                `;

            $('#modal-content').html(modalContent);
            $('#restaurantModalLabel').text(restaurant.name);

            // Ensure current restaurant is stored for modal actions
            window.currentModalRestaurant = restaurant;

            const modal = new bootstrap.Modal(document.getElementById('restaurantModal'));
            modal.show();
        }

        function updateStats() {
            const total = displayedRestaurants.length;
            $('#total-restaurants').text(total);

            if (total > 0) {
                // Calculate average rating
                const avgRating = (displayedRestaurants.reduce((sum, r) => sum + r.rating, 0) / total).toFixed(1);
                $('#avg-rating').text(avgRating);

                // Count unique areas
                const areas = new Set(displayedRestaurants.map(r => r.area));
                $('#areas-covered').text(areas.size);
            } else {
                $('#avg-rating').text('0.0');
                $('#areas-covered').text('0');
            }
        }

        function loadMoreRestaurants() {
            currentPage++;
            displayRestaurants();
        }

        function toggleMap() {
            const mapDiv = $('#restaurant-map');
            const toggleBtn = $('#toggle-map');
            const toggleText = $('#map-toggle-text');

            if (mapDiv.is(':visible')) {
                mapDiv.slideUp();
                toggleText.text('Show Map');
                toggleBtn.removeClass('btn-outline-primary').addClass('btn-outline-primary');
            } else {
                mapDiv.slideDown();
                toggleText.text('Hide Map');
                toggleBtn.removeClass('btn-outline-primary').addClass('btn-primary');

                // Simulate map loading
                setTimeout(() => {
                    const mapContent = `
                            <div class="d-flex align-items-center justify-content-center h-100">
                                <div class="text-center">
                                    <i class="bi bi-geo-alt-fill text-success" style="font-size: 4rem;"></i>
                                    <h4 class="mt-3">Interactive Map View</h4>
                                    <p class="text-muted mb-3">Restaurant locations across Penang</p>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="card border-success mb-2">
                                                <div class="card-body py-2">
                                                    <small><strong>Georgetown:</strong> Multiple locations</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="card border-warning mb-2">
                                                <div class="card-body py-2">
                                                    <small><strong>Penang Road:</strong> Heritage area</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="card border-info mb-2">
                                                <div class="card-body py-2">
                                                    <small><strong>Gurney Drive:</strong> Seaside dining</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="card border-danger mb-2">
                                                <div class="card-body py-2">
                                                    <small><strong>Air Itam:</strong> Local favorites</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <small class="text-muted mt-3 d-block">Ready for Google Maps, OpenStreetMap, or similar integration</small>
                                </div>
                            </div>
                        `;
                    mapDiv.html(mapContent);
                }, 500);
            }
        }

        function clearFilters() {
            $('#search-input').val('');
            $('#area-filter').val('all');
            $('#sort-select').val('rating');
            $('.filter-btn').removeClass('active');
            $('.filter-btn[data-filter="all"]').addClass('active');

            currentFilter = 'all';
            currentArea = 'all';
            currentSort = 'rating';
            currentPage = 1;

            displayedRestaurants = [...allRestaurants];
            displayRestaurants();
        }

        // Modal action functions
        function shareRestaurant() {
            if (window.currentModalRestaurant) {
                const restaurant = window.currentModalRestaurant;
                const text = encodeURIComponent(`Check out ${restaurant.name} in ${restaurant.area}! Rating: ${restaurant.rating}/5 ‚≠ê`);
                window.open(`https://wa.me/?text=${text}`, '_blank');
            }
        }

        function getDirections(restaurantId = null) {
            let restaurant;
            if (restaurantId) {
                restaurant = allRestaurants.find(r => r.id === restaurantId);
                console.log('Found restaurant by ID:', restaurant);
            } else {
                restaurant = window.currentModalRestaurant;
                console.log('Using modal restaurant:', restaurant);
            }

            if (restaurant && restaurant.address) {
                try {
                    // Clean and encode the address
                    const cleanAddress = restaurant.address.replace(/,\s*/g, ', ').trim();
                    const encodedAddress = encodeURIComponent(cleanAddress);
                    const encodedName = encodeURIComponent(restaurant.name);

                    // Create Google Maps URL - try address first, fallback to name+location
                    const mapsUrl = `https://www.google.com/maps/search/?api=1&query=${encodedAddress}`;

                    console.log('Opening maps URL:', mapsUrl);

                    // Show toast notification
                    showToast('Opening Directions', `Getting directions to ${restaurant.name}...`, 'info');

                    // Open Google Maps in new tab
                    const mapWindow = window.open(mapsUrl, '_blank');

                    // Check if popup was blocked
                    if (!mapWindow) {
                        showToast('Popup Blocked', 'Please allow popups to open Google Maps directions.', 'warning');
                    }

                } catch (error) {
                    console.error('Error creating maps URL:', error);
                    showToast('Error', 'Could not create directions link.', 'danger');
                }
            } else {
                console.error('Restaurant data missing or incomplete:', restaurant);
                showToast('Error', 'Restaurant address information not available.', 'danger');
            }
        }

        function addToFavorites() {
            if (window.currentModalRestaurant) {
                const restaurant = window.currentModalRestaurant;

                if (!favouriteRestaurants.find(fav => fav.id === restaurant.id)) {
                    favouriteRestaurants.push(restaurant);
                    localStorage.setItem('penangRestaurantFavorites', JSON.stringify(favouriteRestaurants));
                    updateFavouriteCount();

                    // Update the heart icon in the card if visible
                    $(`.favourite-toggle-btn[data-restaurant-id="${restaurant.id}"] i`)
                        .removeClass('bi-heart text-muted')
                        .addClass('bi-heart-fill text-danger');
                    $(`.favourite-toggle-btn[data-restaurant-id="${restaurant.id}"]`)
                        .attr('title', 'Remove from favourites');

                    showToast('Added to Favorites!', `${restaurant.name} has been saved to your favorites.`, 'success');
                } else {
                    showToast('Already in Favorites', `${restaurant.name} is already in your favorites.`, 'info');
                }
            }
        }

        // Utility functions
        function generateRatingStars(rating) {
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 >= 0.5;
            const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);

            return '‚òÖ'.repeat(fullStars) +
                (hasHalfStar ? '‚òÜ' : '') +
                '‚òÜ'.repeat(emptyStars);
        }

        function showLoading(show) {
            if (show) {
                $('#loading').show();
                $('#restaurants-container').hide();
                $('#results-stats').hide();
            } else {
                $('#loading').hide();
                $('#restaurants-container').show();
            }
        }

        function showToast(title, message, type) {
            const toastHtml = `
                    <div class="toast align-items-center text-white bg-${type} border-0" role="alert" aria-live="assertive" aria-atomic="true">
                        <div class="d-flex">
                            <div class="toast-body">
                                <strong>${title}</strong><br>${message}
                            </div>
                            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                        </div>
                    </div>
                `;

            if (!$('#toast-container').length) {
                $('body').append('<div id="toast-container" class="toast-container position-fixed top-0 end-0 p-3"></div>');
            }

            $('#toast-container').append(toastHtml);
            const toastElement = $('#toast-container .toast:last')[0];
            const toast = new bootstrap.Toast(toastElement);
            toast.show();

            $(toastElement).on('hidden.bs.toast', function () {
                $(this).remove();
            });
        }

       

        // Custom CSS for enhanced styling
        $('<style>')
            .prop('type', 'text/css')
            .html(`
                    .restaurant-card {
                        transition: transform 0.3s ease, box-shadow 0.3s ease;
                        cursor: pointer;
                    }
                    .restaurant-card:hover {
                        transform: translateY(-5px);
                        box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;
                    }
                    .rating {
                        color: #ffc107;
                    }
                    .rating-large {
                        font-size: 1.5rem;
                        color: #ffc107;
                    }
                    .filter-btn {
                        margin: 2px;
                        transition: all 0.3s ease;
                    }
                    .filter-btn.active {
                        background-color: #39765f;
                        border-color: #39765f;
                        color: white;
                    }
                    .share-buttons {
                        display: flex;
                        gap: 8px;
                        flex-wrap: wrap;
                    }
                    .share-buttons .btn {
                        flex: 1;
                        min-width: 120px;
                    }
                    .favourite-toggle-btn {
                        transition: all 0.3s ease;
                    }
                    .favourite-toggle-btn:hover {
                        transform: scale(1.1);
                    }
                    @media (max-width: 768px) {
                        .btn-group {
                            flex-direction: column;
                            width: 100%;
                        }
                        .btn-group .btn {
                            margin-bottom: 5px;
                        }
                        .restaurant-card {
                            margin-bottom: 1rem;
                        }
                        .share-buttons {
                            flex-direction: column;
                        }
                        .share-buttons .btn {
                            width: 100%;
                            margin-bottom: 8px;
                        }
                    }
                `)
            .appendTo('head');
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {

            const navAuthSection = document.getElementById('nav-auth-section');
            const getUsers = () => JSON.parse(localStorage.getItem('users')) || [];

            //get cookie
            const getCookie = (name) => {
                const nameEQ = name + "=";
                const ca = document.cookie.split(';');
                for (let i = 0; i < ca.length; i++) {
                    let c = ca[i];
                    while (c.charAt(0) === ' ') c = c.substring(1, c.length);
                    if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
                }
                return null;
            };

            //check log in
            const getLoggedInUser = () => getCookie('loggedInUser');


            //update vavigation bar
            const updateNavbar = () => {
                const loggedInUsername = getLoggedInUser();
                navAuthSection.innerHTML = '';

                if (loggedInUsername) {
                    const users = getUsers();
                    const user = users.find(u => u.username === loggedInUsername);

                    const displayName = user ? (user.nickname || user.username) : loggedInUsername;
                    const avatarSrc = user ? user.avatar : 'images/user-logo.png';

                    navAuthSection.innerHTML = `
                            <li class="nav-item">
                                <a id="nav-profile-link" class="nav-link d-flex align-items-center" href="account.html" title="View Profile">
                                    ${displayName.toUpperCase()}
                                    <img src="${avatarSrc}" alt="User Avatar" class="ms-2" height="35" width="35" style="border-radius: 50%; object-fit: cover;">
                                </a>
                            </li>
                        `;
                } else {

                    navAuthSection.innerHTML = `
                            <li class="nav-item">
                                <a id="nav-signin-link" class="account nav-link" href="account.html">
                                    SIGN IN <img class="user-icon" src="images/user-logo.png" height="35" width="35">
                                </a>
                            </li>
                        `;
                }
            };

            //update
            updateNavbar();
        });
    </script>
</body>
</html>